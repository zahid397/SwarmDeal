<div class="card chat-box">
  <div class="header">
    <div class="ai-profile">
      <div class="avatar">ðŸ¤–</div>
      <div>
        <h3>AI Assistant</h3>
        <span class="status">Always Active</span>
      </div>
    </div>
  </div>
  
  <div id="chat-history" class="history">
    <div class="msg ai">
      Hello! I can help you form a group buy. <br>
      Try saying: <strong>"I want a MacBook Pro with 5 people"</strong>
    </div>
  </div>

  <div class="input-area">
    <input type="text" id="chat-input" placeholder="Type your request..." />
    <button id="send-btn" class="btn-primary">Send</button>
  </div>
</div>

<style>
  .chat-box { 
    height: 600px; 
    display: flex; 
    flex-direction: column; 
    background: white; /* Explicit White */
  }
  .header { 
    padding-bottom: 1rem; 
    border-bottom: 1px solid var(--border); 
  }
  .ai-profile { display: flex; gap: 12px; align-items: center; }
  .avatar { 
    width: 40px; height: 40px; 
    background: #eff6ff; 
    color: var(--primary);
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 1.2rem;
  }
  .header h3 { font-size: 1rem; font-weight: 700; color: var(--text-main); }
  .status { font-size: 0.8rem; color: var(--accent); font-weight: 500; }
  
  .history { 
    flex: 1; 
    overflow-y: auto; 
    padding: 1.5rem 0; 
    display: flex; 
    flex-direction: column; 
    gap: 1rem; 
  }
  
  .msg { 
    padding: 12px 16px; 
    border-radius: 12px; 
    font-size: 0.95rem; 
    max-width: 85%; 
    line-height: 1.5;
  }
  
  .ai { 
    background: #f1f5f9; 
    color: var(--text-main); 
    align-self: flex-start; 
    border-bottom-left-radius: 4px;
  }
  
  .user { 
    background: var(--primary); 
    color: white; 
    align-self: flex-end; 
    border-bottom-right-radius: 4px;
    box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.2);
  }
  
  .input-area { 
    display: flex; 
    gap: 10px; 
    padding-top: 1rem; 
    border-top: 1px solid var(--border); 
  }
</style>

<script>
  // Logic remains EXACTLY SAME as before, just UI changed above.
  import { api } from '../utils/api.js';
  const input = document.getElementById('chat-input');
  const btn = document.getElementById('send-btn');
  const history = document.getElementById('chat-history');
  let messages = [];

  async function sendMessage() {
    const text = input.value.trim();
    if (!text) return;
    appendMsg(text, 'user');
    input.value = '';
    btn.innerText = '...';
    btn.disabled = true;

    try {
      const res = await api.post('/ai/chat', { message: text, address: 'guest', context: messages.slice(-5) });
      appendMsg(res.data.response, 'ai');
      if (res.data.deal) window.dispatchEvent(new CustomEvent('deal-found', { detail: res.data.deal }));
    } catch (e) {
      appendMsg("Server offline. Please check backend.", 'ai');
    } finally {
      btn.innerText = 'Send';
      btn.disabled = false;
    }
  }

  function appendMsg(text, role) {
    const div = document.createElement('div');
    div.className = `msg ${role}`;
    div.innerHTML = text; // Allow HTML for bold text
    history.appendChild(div);
    history.scrollTop = history.scrollHeight;
    messages.push({ role, content: text });
  }

  btn.addEventListener('click', sendMessage);
  input.addEventListener('keypress', (e) => e.key === 'Enter' && sendMessage());
</script>
